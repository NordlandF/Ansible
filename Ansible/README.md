Данный playbook (shinji.yaml) подготовлен в рамках задания по изучению особенностей и функционала Ansible

"Роль" данного плейбука - это установка через сервер на хост простейшую страницу в интернете, развернутую с помощью Nginx, с дальнейшим получением 
сертификатов на данный сайт, для его работы на https протоколе. При повторном использовании плейбука учитываются отслеживание изменений
в конфигурационном файле nginx, связанный с ним контент, а также анализ наличия сертификата для развертывающегося сайта.

Основными нюансами при выполенении задания являлись:
- Создание на сервере 2-х дополнительных файлов с конфигурацией nginx (1-й до получения сертификации (порт 80),
 второй после (перенаправление, порт 443 и 80, расположения файлов с сертификатом и ключом к нему) (директория nginxconf).
- Создание дополнительных html-файлов (директория nginxsite)

Основные этапы описаны в виде коментариев в самом плейбуке, и не препятствуют его работе. Ниже будет программирование перечень задач (tasks) из плейбука.

ПРИ СКАЧИВАНИИ ФАЙЛА НЕОБХОДИМО ЗАМЕНИТЬ В ПЛЕЙБУКЕ ДИРЕКТОРИЮ Nord (/home/nord/...) НА НАЗВАНИЕ ВАШЕЙ ПОЛЬЗОВАТЕЛЬСКОЙ ДИРЕКТОРИИ, КУДА БЫЛ ЗАГРУЖЕН ДАННЫЙ КАТАЛОГ ИЗ РЕПОЗИТОРИЯ

Имя сервера - nord
Имя хоста - shinji
Домен сайта - nord1.uberlegenheit.ru

Ниже таски:

#Проверка установлен ли nginx. Если нет, то установка nginx и запуск блока с настрокой nginx \ Если да, пропуск блока nginx
 Блок nginx
 - #Запуск блока 1 - первичная настройка Nginx
 - #Добавление Nginx в автозапуск
 - #Удаление дефолтных настроек (конфиг)
 - #Удаление ссылки на дефолтные настройки (конфиг)
 Конец блока
#Проверка изменений в настроенном для хоста конфиге или копирование настроенного конфига
#Проверка изменений в настроенном для хоста начинки сайта или копирование данного контента
#Перезапуск Nginx для работы сайта при внесеных изменениях в конфиге или контенте (при первичной настройке выдает ошибку)
#Выгрузка информации из сертификата в переменную 
#Получения информации о сертификате или проверка его наличия в указанной директории
#При отсутствии в директории сертификата запускается блок "Сертификация", в ином случае весь блок скипается
 Блок Сертификация
 - #Копирование конфига, работающего на порте 80, и без указания места расположения сертификата и ключа к нему
 - #Копирование содержимого сайта, который описан в скопированном конфиге из предыдущего шага
 - #Перезапуск Nginx, для запуска работы сайта по настройкам из предыдущих двух шагов в блоке
 - #Установка Certbot для получения сертификата
 - #Создание каталогов для хранения необходимых файлов для получения сертификатов
 - #Генерация ключа аккаунта LE
 - #Генерация приватного ключа LE
 - #Генерация запроса на подпись сертификата
 - #Отправка запроса на подпись сертификата
 - #Создание структуры каталогов .well-known/acme-challenge/, на которых должен работать сайт для получения сертификата
 - #Чтение и применения challenge-файлов ACME, для подтверждения прав получить сертификат для запрошенных доменов и поддоменов
 - #Активация сервиса LE для проверки отправленных файлов с запросами, получение подписанного сертификата
 - #Копирование конфига, работающего на порте 80 и 443, с указанием расположений сертификатов и ключей, а так же перенаправление с http на https
 - #Копирование контента, который учтен в конфиге
 - #Перезапуск Nginx для восстановления работы сайта уже на https протоколе
 Конец Блока
